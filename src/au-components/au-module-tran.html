<template>
  <require from="au-views/au-icon-nav-right.html"></require>
  <require from="au-views/au-icon-nav-up.html"></require>
  <require from="au-views/au-icon-nav-down.html"></require>
  <require from="au-views/au-icon-nav-left.html"></require>
  <require from="au-views/au-icon-nav-left-left.html"></require>
  <require from="au-views/au-icon-new.html"></require>
  <require from="au-views/au-icon-edit.html"></require>
  <require from="au-views/au-icon-delete.html"></require>
  <require from="au-views/au-icon-row-mover.html"></require>
  <require from="au-views/au-icon-ellipsis.html"></require>
  <require from="au-views/au-icon-radio-unselected.html"></require>
  <require from="au-views/au-icon-radio-selected.html"></require>
  <require from="au-views/au-text-ellipsis.html"></require>
  <require from="au-views/au-grid-bchg-cells-spacer.html"></require>
  <require from="au-views/au-vertical-gridline.html"></require>
  <require from="au-views/au-vertical-gridline-spacer.html"></require>
  <require from="au-views/au-grid-bchg-cells-spacer.html"></require>
  <require from="au-converters/au-currency-converter"></require>
  <require from="au-components/au-grid-bchg-cells-heading"></require>
  <require from="au-components/au-grid-bchg-cells"></require>
  <require from="au-components/au-grid-bchg-cells-edit"></require>
  <require from="au-components/au-grid-bchg-cells-total"></require>

  <div class="aaPanel aaPanelBoxShadow" css="${app.selectedModule == app.MODULE_TRAN ? '' : 'display: none;'}">
    <div class="aaPanelHeader aaPanelHeaderModule">Transaction</div>
    <template if.bind="tranView == NAV || tranView == DELETE">
      <template if.bind="tranView == NAV">
        <div class="aaPanelToolBar">
          <div class="aaInlineFlex" style="justify-content: center;">
            <span class="aaToolBarDivider">.</span>
            <button type="button"
                    class="aaBtn"
                    click.trigger="tranNew($event)">
              <au-icon-new></au-icon-new>
              New transaction
            </button>
            <button type="button"
                    class="aaBtn"
                    click.trigger="tranEdit($event)">
              <au-icon-edit></au-icon-edit>
              Edit this transaction
            </button>
            <button type="button"
                    class="aaBtn"
                    click.trigger="tranDelete($event)">
              <au-icon-delete></au-icon-delete>
              Delete this transaction
              <au-text-ellipsis></au-text-ellipsis>
            </button>
            <span class="aaToolBarDivider">.</span>
          </div>
        </div>
      </template>
      <template if.bind="tranView == DELETE">
        <div class="aaPanelToolBar">
          <span class="aaToolBarDivider">.</span>
          <span class="aaFontLabel aaFontBold">Delete transaction:</span>
          <span class="aaToolBarDivider aaHidden">.</span>
          <button type="button" class="aaBtn" click.trigger="tranDeleteConfirmed($event)">Confirm</button>
          <span class="aaToolBarDivider aaHidden">.</span>
          <button type="button" class="aaBtn" click.trigger="tranDeleteCancel($event)">Cancel</button>
          <span class="aaToolBarDivider">.</span>
        </div>
      </template>
      <div class="aaPanelBody">
        <table border="0" style="border-collapse: collapse;">
          <tr>
            <td class="aaFormItemLabel">Date:</td>
            <td>
              <span class="aaCell aaCellBorder aaCellTranDate">${app.selectedTran.date}</span>
            </td>
          </tr>
        </table>
        <div class="aaGridContainer">
          <div class="aaGridTitleBar">Account balance changes</div>
          <div class="aaRow aaRowColumnHeaders aaFontLabel aaFontBold">
            <div class="aaRowOps aaFontLabel aaHidden">
              <div class="aaRadioBtn">
                <au-icon-radio-unselected></au-icon-radio-unselected>
              </div>
            </div>
            <div class="aaVerticalGridline" style="background-color: #999; width: 3px;"></div>
            <div class="aaRowData">
              <au-grid-bchg-cells-heading fae-side.one-time="'asset'"></au-grid-bchg-cells-heading>
              <div class="aaVerticalGridline" style="background-color: #999; width: 3px;"></div>
              <au-grid-bchg-cells-heading fae-side.one-time="'equity'"></au-grid-bchg-cells-heading>
            </div>
            <div class="aaVerticalGridline" style="background-color: #999; width: 3px;"></div>
          </div>

          <div class="aaGridScrollableRows" id="tranModule-${app.selectedTran.id}" style="height: 25pc;">
            <template repeat.for="bchg of app.selectedTran.bchgList">
              <div class="aaRow" style="border-bottom-width: 3px;"
                   mouseenter.trigger="onRowEnter($event, bchg)"
                   mouseleave.trigger="onRowLeave($event, bchg)"
                   click.trigger="app.selectBchg(bchg)"
                   dblclick.trigger="app.selectTranBchgGoAcct(bchg)">
                <div class="aaRowOps aaBgColorToolbar aaFontSizeLabel">
                  <div class="aaRadioBtn">
                    <template if.bind="app.selectedBchg.id == bchg.id">
                      <au-icon-radio-selected></au-icon-radio-selected>
                    </template>
                    <template if.bind="app.selectedBchg.id != bchg.id">
                      <au-icon-radio-unselected></au-icon-radio-unselected>
                    </template>
                  </div>
                </div>
                <div class="aaVerticalGridline" style="width: 3px;"></div>
                <div class="aaRowData aaRowBgColorData">
                  <template if.bind="bchg.targetAcct.parentFaeSide.id == 'Equities'">
                    <!-- blank space in change-to-asset column -->
                    <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
                    <div class="aaVerticalGridline" style="width: 3px;"></div>
                  </template>
                  <!-- column with read-only data cells -->
                  <au-grid-bchg-cells bchg.one-way="bchg"></au-grid-bchg-cells>
                  <template if.bind="bchg.targetAcct.parentFaeSide.id == 'Assets'">
                    <!-- blank space in change-to-equity column -->
                    <div class="aaVerticalGridline" style="width: 3px;"></div>
                    <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
                  </template>
                </div>
                <div class="aaVerticalGridline" style="width: 3px;"></div>
              </div>
            </template>
            <!--
            The purpose of having the following invisible end-of-list row
            is to provide an invisible horizontal spacer if tran.bchgList is empty
            so as to display the column headings row properly..
            -->
            <div class="aaRow aaHidden" style="border-bottom-width: 3px;">
              <div class="aaRowOps aaBgColorToolbar aaFontSizeLabel">
                <div class="aaRadioBtn">
                  <au-icon-radio-unselected></au-icon-radio-unselected>
                </div>
              </div>
              <div class="aaVerticalGridline" style="width: 3px;"></div>
              <div class="aaRowData aaHidden">
                <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
                <div class="aaVerticalGridline" style="width: 3px;"></div>
                <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
              </div>
              <div class="aaVerticalGridline" style="width: 3px;"></div>
            </div>
          </div>
          <div class="aaGridFooterBar"></div>
        </div>
        <!-- net change amt for eash side -->
        <div class="aaGridContainer"
             style="border-color: transparent; background-color: transparent;">
          <div class="aaRow aaFontLabel" style="border-color: transparent; background-color: transparent;">
            <div class="aaRowOps aaFontLabel aaHidden">
              <div class="aaRadioBtn">
                <au-icon-radio-unselected></au-icon-radio-unselected>
              </div>
            </div>
            <div class="aaVerticalGridline aaHidden" style="width: 3px;"></div>
            <div class="aaRowData">
              <au-grid-bchg-cells-total
                fae-side.one-way="'assets'"
                side-total-changes.one-way="app.selectedTran.totalChangesAssets"
                other-side-total-changes.one-way="app.selectedTran.totalChangesEquities">
              </au-grid-bchg-cells-total>

              <div class="aaVerticalGridline aaHidden" style="width: 3px;"></div>
              <au-grid-bchg-cells-total
                fae-side.one-way="'equities'"
                side-total-changes.one-way="app.selectedTran.totalChangesEquities"
                other-side-total-changes.one-way="app.selectedTran.totalChangesAssets">
              </au-grid-bchg-cells-total>
            </div>
            <div class="aaVerticalGridline aaHidden" style="width: 3px;"></div>
          </div>
        </div>
      </div>
    </template>
    <template if.bind="tranView == NEW || tranView == EDIT">
      <div class="aaPanelToolBar">
        <span class="aaToolBarDivider">.</span>
        <template if.bind="tranView == EDIT">
          <span class="aaFontLabel aaFontBold">Editing transaction:</span>
          <span class="aaToolBarDivider aaHidden">.</span>
          <button type="button" class="aaBtn" click.trigger="tranEditDone($event)">Done</button>
          <span class="aaToolBarDivider aaHidden">.</span>
          <button type="button" class="aaBtn" click.trigger="tranEditCancel($event)">Cancel</button>
          <span class="aaToolBarDivider">.</span>
        </template>
        <template if.bind="tranView == NEW">
          <span class="aaFontLabel aaFontBold">Creating new transaction:</span>
          <span class="aaToolBarDivider aaHidden">.</span>
          <button type="button" class="aaBtn" click.trigger="tranNewDone($event)">Done</button>
          <span class="aaToolBarDivider aaHidden">.</span>
          <button type="button" class="aaBtn" click.trigger="tranNewCancel($event)">Cancel</button>
          <span class="aaToolBarDivider">.</span>
        </template>
        <div class="aaInlineBlock"></div>
      </div>
      <div class="aaPanelBody"
           element.ref="popupTop">
        <table border="0" style="border-collapse: collapse;">
          <tr>
            <td class="aaFormItemLabel">Date:</td>
            <td>
              <span class="aaCell aaCellBorder aaCellTranDate">${app.candidateTran.date}</span>
            </td>
          </tr>
        </table>
        <div class="aaGridContainer">
          <div class="aaGridTitleBar">Account balance changes</div>
          <div class="aaPanelToolBar" style="text-align: center;">
            <button type="button"
                    class="aaBtn"
                    click.trigger="app.viewmodelPopupBchgMover.open()">
              Move rows
              <au-text-ellipsis></au-text-ellipsis>
            </button>
          </div>
          <div class="aaRow aaRowColumnHeaders aaFontLabel aaFontBold">
            <div class="aaRowOps aaFontLabel aaHidden">
              <span class="aaBtn">
                <au-icon-new></au-icon-new>
              </span>
              <span class="aaBtn">
                <au-icon-delete></au-icon-delete>
              </span>
            </div>
            <div class="aaVerticalGridline" style="background-color: #999; width: 3px;"></div>
            <div class="aaRowData">
              <au-grid-bchg-cells-heading fae-side.one-time="'asset'"></au-grid-bchg-cells-heading>
              <div class="aaVerticalGridline" style="background-color: #999; width: 3px;"></div>
              <au-grid-bchg-cells-heading fae-side.one-time="'equity'"></au-grid-bchg-cells-heading>
            </div>
            <div class="aaVerticalGridline" style="background-color: #999; width: 3px;"></div>
          </div>
          <div class="aaGridScrollableRows" id="app.candidateTran-${app.selectedTran.id}" style="height: 25pc;">
            <template repeat.for="bchg of app.candidateTran.bchgList">
              <div class="aaRow" style="border-bottom-width: 3px;"
                   mouseenter.trigger="onRowEnter($event, bchg)"
                   mouseleave.trigger="onRowLeave($event, bchg)">
                <div class="aaRowOps aaBgColorToolbar aaFontSizeLabel">
                  <div class="aaRowOpsOpacity">
                    <span class="aaBtn" title="Insert new row..."
                          click.trigger="app.viewmodelPopupAcctPicker.open(bchg, pickAcctDone)">
                      <au-icon-new></au-icon-new>
                    </span>
                    <span class="aaBtn" title="Delete row..." click.trigger="bchgDelete(bchg)">
                      <au-icon-delete></au-icon-delete>
                    </span>
                  </div>
                </div>
                <div class="aaVerticalGridline" style="width: 3px;"></div>
                <div class="aaRowData aaRowBgColorData">
                  <!-- spacer if equities side -->
                  <template if.bind="bchg.targetAcct.parentFaeSide.id == 'Equities'">
                    <!-- blank space in change-to-asset column -->
                    <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
                    <div class="aaVerticalGridline" style="width: 3px;"></div>
                  </template>
                  <!-- column for editable data cells -->
                  <au-grid-bchg-cells-edit bchg.one-way="bchg"
                                           viewmodel-popup-acct-picker.one-time="viewmodelPopupAcctPicker">
                  </au-grid-bchg-cells-edit>
                  <template if.bind="bchg.targetAcct.parentFaeSide.id == 'Assets'">
                    <!-- blank space in change-to-equity column -->
                    <div class="aaVerticalGridline" style="width: 3px;"></div>
                    <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
                  </template>
                </div>
                <div class="aaVerticalGridline" style="width: 3px;"></div>
              </div>
            </template>
            <!-- End of list row -->
            <div class="aaRow" style="border-bottom-width: 3px;"
                 mouseenter.trigger="onRowEnter($event, null)"
                 mouseleave.trigger="onRowLeave($event, null)">
              <div class="aaRowOps aaBgColorToolbar aaFontSizeLabel">
                <div class="aaRowOpsOpacity">
                    <span class="aaBtn" title="Insert new row..."
                          click.trigger="app.viewmodelPopupAcctPicker.open(null, pickAcctDone)">
                      <au-icon-new></au-icon-new>
                    </span>
                  <span class="aaBtn aaHidden">
                      <au-icon-delete></au-icon-delete>
                    </span>
                </div>
              </div>
              <div class="aaVerticalGridline" style="width: 3px;"></div>
              <div class="aaRowData aaHidden">
                <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
                <div class="aaVerticalGridline" style="width: 3px;"></div>
                <au-grid-bchg-cells-spacer></au-grid-bchg-cells-spacer>
              </div>
              <div class="aaVerticalGridline" style="width: 3px;"></div>
            </div>
          </div>
          <div class="aaGridFooterBar"></div>
        </div>
        <!-- net change amt for eash side -->
        <div class="aaGridContainer"
             style="border-color: transparent; background-color: transparent;">
          <div class="aaRow aaFontLabel" style="border-color: transparent; background-color: transparent;">
            <div class="aaRowOps aaFontLabel aaHidden">
              <button type="button" class="aaBtn">
                <au-icon-nav-left></au-icon-nav-left>
              </button>
              <button type="button" class="aaBtn">
                <au-icon-nav-left-left></au-icon-nav-left-left>
              </button>
            </div>
            <div class="aaVerticalGridline aaHidden" style="width: 3px;"></div>
            <div class="aaRowData">
              <au-grid-bchg-cells-total
                fae-side.one-way="'assets'"
                side-total-changes.one-way="app.candidateTran.totalChangesAssets"
                other-side-total-changes.one-way="app.candidateTran.totalChangesEquities">
              </au-grid-bchg-cells-total>
              <div class="aaVerticalGridline aaHidden" style="width: 3px;"></div>
              <au-grid-bchg-cells-total
                fae-side.one-way="'equities'"
                side-total-changes.one-way="app.candidateTran.totalChangesEquities"
                other-side-total-changes.one-way="app.candidateTran.totalChangesAssets">
              </au-grid-bchg-cells-total>
            </div>
            <div class="aaVerticalGridline aaHidden" style="width: 3px;"></div>
          </div>
        </div>
      </div>
    </template>
  </div>
</template>
